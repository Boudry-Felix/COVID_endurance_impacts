---
params:
  new_title: "My title"
title: "`r params$new_title`"
author: "FÃ©lix Boudry"
date: "`r Sys.Date()`"
documentclass: article
classoption: oneside
lang: en-US
output:
  html_document: 
    toc: yes
    number_section: yes
    fig_caption: yes
    number_sections: yes
  word_document:
    toc: yes
    number_sections: 4
    fig_caption: yes
  pdf_document: 
    toc: yes
    toc_depth: 4
    number_sections: yes
    fig_caption: yes
    df_print: kable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	error = TRUE,
	message = FALSE,
	warning = FALSE
)
# Import libraries
library(knitr)
library(tibble)
library(janitor)
library(dplyr)
library(CatEncoders)
library(ggplot2)
library(psych)
library(kableExtra)
library(plyr)
library(gridExtra)
```

```{r Sourcing}
rm(list = setdiff(
  x = ls(),
  y = c(
    "my_var",
    "gen_env",
    "studied_populations",
    "my_population",
    "my_count",
    "var_count"
  )
))
source("Scripts/Import.R")
source("Scripts/Subset.R")
my_data <- .GlobalEnv$studied_populations$complete
my_var <- c("sex")
source(file = "Scripts/Descriptive.R")
```

# Population description

## Anthropometrics

Some anthropometric data about the population in this study:

In the population kept in this study there are
**`r my_results$num$results_antrop$population_caracteristics$sex$feminin`** womens and
**`r my_results$num$results_antrop$population_caracteristics$sex$masculin`** mens and all of the
**`r nrow(my_data)`** subjects (all) were infected by COVID-19.

```{r}
my_table(my_data$covid_test)
my_table(my_results$num$results_antrop$antrop_values)
my_results$plots$plots_antrop$antrop_plots %>%
  marrangeGrob(ncol = 3, nrow = 1)
```

## Training

```{r}
marrangeGrob(
  grobs = list(
    my_results$plots$plots_training$endu,
    my_results$plots$plots_training$fede
  ),
  nrow = 1,
  ncol = 2
)
```

In the studied population, **`r my_results$num$results_training$my_training_counts$endurance_sport$oui`** are endurance
trained athletes.

Various types of activities are done by the subjects. (potential errors during 
computing!)

```{r}
my_results$plots$plots_training$sport
my_results$plots$plots_training$train_volume
my_results$plots$plots_training$train_sessions
```

## Professions

Subject's professions are shown below:

```{r}
my_results$plots$plots_antrop$professions
```

## Pathologies

`r count(my_data$pathology)[2, 2]` have a known pathology.

```{r}
my_results$plots$plots_pathologies$patho_description
my_results$plots$plots_pathologies$patho_medication
```

# COVID impact on training

## During COVID

```{r}
# my_results$plots$plots_covid$covid_symptoms
covid_symptoms <-
  my_data[, c(
    "cough",
    "fever",
    "runny_nose",
    "headache",
    "sore_throat",
    "tired",
    "muscular_pain",
    "vomiting",
    "diarrhea",
    "breathlessness",
    "respiratory_difficulties",
    "other_symptoms"
  )]
mapply(
  FUN = function(my_column, my_colname) {
    ggplot(mapping = aes(x = my_column)) +
      geom_bar(aes(fill = my_data[[my_var]])) +
      geom_text(aes(label = after_stat(count)), stat = "count", vjust = 1) +
      ggtitle(my_colname) +
      labs(fill = my_var)
  },
  my_column = covid_symptoms,
  my_colname = colnames(covid_symptoms),
  SIMPLIFY = FALSE
) %>%
  marrangeGrob(nrow = 2, ncol = 3)
```

## Post COVID

```{r}
ggplot(my_data, aes(
  x = reorder(duration_to_training, duration_to_training, function(x)
    -length(x))
)) +
  geom_bar(aes(fill = my_data$endurance_sport)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  xlab("Duration to training resumption") +
  labs(fill = "Endurance")
```

```{r}
covid_symp <-
  my_data[, c(
    "after_cough",
    "after_fever",
    "after_runny_nose",
    "after_headache",
    "after_sore_throat",
    "after_tired",
    "after_muscular_pain",
    "after_vomiting",
    "after_diarrhea",
    "after_breathlessness",
    "after_respiratory_difficulties"
  )]
mapply(
  FUN = function(my_column, my_colname) {
    ggplot(mapping = aes(x = my_column)) +
      geom_bar(aes(fill = my_data[[my_var]])) +
      geom_text(aes(label = ..count..), stat = "count", vjust = 2) +
      ggtitle(my_colname) +
      labs(fill = my_var)
  },
  my_column = covid_symp,
  my_colname = colnames(covid_symp),
  SIMPLIFY = FALSE
) %>%
  marrangeGrob(nrow = 2, ncol = 3)

covid_symp <-
  my_data[, c(
    "training_tired",
    "training_concentration_difficulties",
    "training_muscular_pain",
    "training_respiratory_difficulties"
  )]
mapply(
  FUN = function(my_column, my_colname) {
    ggplot(mapping = aes(x = my_column)) +
      geom_bar(aes(fill = my_data$endurance_sport)) +
      geom_text(aes(label = ..count..), stat = "count", vjust = 2) +
      ggtitle(my_colname) +
      labs(fill = "Endurance")
  },
  my_column = covid_symp,
  my_colname = colnames(covid_symp),
  SIMPLIFY = FALSE
) %>%
  marrangeGrob(nrow = 2, ncol = 2)

covid_symp <-
  my_data[, c(
    "training_tired_note",
    "training_concentration_difficulties_note",
    "training_muscular_pain_note",
    "training_respiratory_difficulties_note"
  )]
mapply(
  FUN = function(my_column, my_colname) {
    ggplot(mapping = aes(x = my_column)) +
      geom_histogram(aes(fill = my_data$raw_data$completed$endurance_sport)) +
      # geom_text(aes(label = ..count..), stat = "count", vjust = 2) +
      ggtitle(my_colname) +
      labs(fill = "Endurance")
  },
  my_column = covid_symp,
  my_colname = colnames(covid_symp),
  SIMPLIFY = FALSE
) %>%
  marrangeGrob(nrow = 2, ncol = 2)

ggplot(data = my_data, aes(
  x = reorder(difficulties_duration, difficulties_duration, function(x)
    -length(x))
)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  xlab("Difficulties duration at training")
```

### Hypoxia training

### Pathologies

